{"version":3,"sources":["miro:mailchimp/lib/server/mailchimp.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA,4C;AACA,M;AACA,qB;AACA,6B;AACA,oC;AACA,K;AACA,iD;AACA,G;AACA,G;;AAEA,0C;AACA,yB;AACA,wD;AACA,0B;AACA,6C;AACA,I;AACA,I;;AAEA,oE;;AAEA,4D;;AAEA,yB;AACA,gB;AACA,wB;AACA,yE;AACA,I;AACA,E;;AAEA,0D;AACA,0B;AACA,0B;AACA,G;AACA,E;;AAEA,4E;AACA,oD;AACA,+D;AACA,4D;AACA,S;AACA,O;AACA,yE;;AAEA,8C;AACA,qB;AACA,uB;AACA,kD;AACA,wB;AACA,wD;AACA,W;AACA,oC;AACA,I;AACA,G;AACA,E;AACA,E;;AAEA,gB;AACA,oE;AACA,iC;AACA,2B;AACA,0B;AACA,2B;;AAEA,gB;AACA,gD;;AAEA,O;AACA,4E;AACA,qB;AACA,sE;AACA,G;;AAEA,sB;AACA,gB;AACA,+D;AACA,2D;AACA,K;;AAEA,U;AACA,W;AACA,G;;AAEA,6D;AACA,E;AACA,G","file":"/packages/miro:mailchimp.js","sourcesContent":["var getSettingsValueFor = function ( key ) {\n\t\tif (\n\t\t\tMeteor.settings &&\n\t\t\tMeteor.settings.private &&\n\t\t\tMeteor.settings.private.MailChimp\n\t\t) {\n\t\t\treturn Meteor.settings.private.MailChimp[key];\n\t\t}\n\t};\n\nMailChimp = function ( apiKey, options ) {\n\tvar mailChimpOptions = {\n\t\t\t'apiKey' : apiKey || getSettingsValueFor( 'apiKey' ),\n\t\t\t'options': options || {\n\t\t\t\t'version': '2.0'\t// Living on The Edge ;)\n\t\t\t}\n\t\t};\n\n\tif ( !mailChimpOptions.apiKey || mailChimpOptions.apiKey === '' ) {\n\n\t\tconsole.error( '[MailChimp] Error: No API Key defined!' );\n\n\t\tthrow new Meteor.Error(\n\t\t\t'No API Key',\n\t\t\t'No API Key defined',\n\t\t\t'Define your API Key either in settings.json file or in a method call'\n\t\t);\n\t}\n\n\tthis._asyncAPI = Npm.require( 'mailchimp' ).MailChimpAPI(\n\t\tmailChimpOptions.apiKey,\n\t\tmailChimpOptions.options\n\t);\n};\n\nMailChimp.prototype.call = function ( section, method, options, callback ) {\n\tif ( callback && typeof callback === 'function' ) {\n\t\t// If anyone still wants to use old-fashioned callback method\n\t\tthis._asyncAPI.call( section, method, options, callback );\n\t} else {\n\t\ttry {\n\t\t\tvar wrapped = Meteor.wrapAsync( this._asyncAPI.call, this._asyncAPI );\n\n\t\t\treturn wrapped( section, method, options );\n\t\t} catch ( error ) {\n\t\t\t// A workaround for:\n\t\t\t// https://github.com/meteor/meteor/issues/2774\n\t\t\tif ( !error.error ) {\n\t\t\t\tthrow new Meteor.Error( error.code, error.message );\n\t\t\t} else {\n\t\t\t\tthrow new Meteor.Error( error );\n\t\t\t}\n\t\t}\n\t}\n};\n\nMeteor.methods({\n\t'MailChimp': function ( clientOptions, section, method, options ) {\n\t\tcheck( clientOptions, Object );\n\t\tcheck( section, String );\n\t\tcheck( method, String );\n\t\tcheck( options, Object );\n\n\t\tvar mailChimp,\n\t\t\tmailChimpOptions = _.defaults( {}, options );\n\n\t\ttry {\n\t\t\tmailChimp = new MailChimp( clientOptions.apiKey, clientOptions.options );\n\t\t} catch ( error ) {\n\t\t\tthrow new Meteor.Error( error.error, error.reason, error.details );\n\t\t}\n\n\t\tswitch ( section ) {\n\t\t\tcase 'lists':\n\t\t\t\tif ( !mailChimpOptions.id || mailChimpOptions.id === '' ) {\n\t\t\t\t\tmailChimpOptions.id = getSettingsValueFor( 'listId' );\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\n\t\treturn mailChimp.call( section, method, mailChimpOptions );\n\t}\n});\n"]}